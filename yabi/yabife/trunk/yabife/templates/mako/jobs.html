<%inherit file="base.html"/>

<%def name="header()">
    ${self.yui("container/container")}

    <link rel="stylesheet" type="text/css" media="screen" href="${h.url('/static/javascript/yui-2.4.1/container/assets/container.css')}" />
    <link rel="stylesheet" type="text/css" media="screen" href="${h.url('/static/css/jobs.css')}" />

    <script type="text/javascript">
        YAHOO.util.Event.onDOMReady(initWorkflowListing);

        var workflowListing, refreshInterval, listingRefreshInterval;

        var examineProgress = function(status) {
            if (status == "completed") {
                window.clearInterval(refreshInterval);
            }
        };

        var fetchProgress = function() {
            workflowListing.loadedWorkflow.fetchProgress( examineProgress );
        };

        var reloadListing = function() {
            workflowListing.hydrate();
        };

        function initWorkflowListing() {
            workflowListing = new YabiWorkflowCollection();
            document.getElementById("workflowListingContainer").appendChild(workflowListing.containerEl);
            
            workflowListing.slider.subscribe("change", function() { workflowListing.changeDateRange(); });
            
            workflowListing.onSelectionCallback = function() {
                if (refreshInterval !== null) {
                    window.clearInterval(refreshInterval);
                }
                
                refreshInterval = window.setInterval( fetchProgress , 5000 );
            }
            
            listingRefreshInterval = window.setInterval( reloadListing, 60000 );
            
            document.getElementById("container").appendChild(workflowListing.noSelectionDiv);
            
            document.getElementById("container").appendChild(workflowListing.loadedWorkflowEl);
            
            document.getElementById("optionsDiv").appendChild(workflowListing.loadedWorkflowFileOutputsEl);
            
            document.getElementById("optionsDiv").appendChild(workflowListing.loadedWorkflowOptionsEl);
            
            //test for anchor tag, if it exists, load that workflow
            if (window.location.hash.length > 1) {
                workflowListing.select(window.location.hash.substr(1));
            }
        }
    </script>
</%def>

<%def name="body()">
    <div id="doc3" class="yui-t1">
        <div id="yabi-jobs-mode">
            ${self.bodyhd()}

            <div class="yabiLeftColumn">
                <div id="workflowListingContainer"></div>
            </div>
            <div class="yabiMiddleColumn">
                <div id="container"></div>
            </div>
            <div class="yabiRightColumn">
            <div style="position:absolute;left:10px;top:63px;padding:5px;min-width:400px;">
                <div id="optionsDiv"></div>
            </div>
        </div>
    </div>
  
    ${self.copyright()}
</%def>
