<%inherit file="base.html"/>
<%def name="header()">

<script language="javascript">
YAHOO.util.Event.onAvailable("container", initWorkflow);

var workflow;
var tools;

function initWorkflow() {
    tools = new YabiToolCollection();
    
    document.getElementById("toolContainer").appendChild(tools.containerEl);
    
    workflow = new YabiWorkflow(true);
    
    document.getElementById("container").appendChild(workflow.mainEl);
    document.getElementById("optionsDiv").appendChild(workflow.optionsEl);
    
    YAHOO.util.Event.addListener("submitButton", "click", submitCallback, workflow);
}


function submitCallback(e, wf) {
    

    // TODO remove hardcoded url
    // TODO add decent callbacks
    YAHOO.util.Event.stopEvent(e);

    var baseURL = "http://127.0.0.1:8000/ws/submitworkflow/";
    
    jsCallback = {
        success: function (obj) {alert("Success on submit!");},
        failure: function (obj){alert("Fail on submit!");},
        argument: [this] };
    var data = "workflowjson=" + wf.toJSON()
    jsTransaction = YAHOO.util.Connect.asyncRequest('POST', baseURL, jsCallback, data);
}


function summonJob(toolName) {
    workflow.addJob(toolName);
}

function destroyWorkflow() {
    workflow.destroy();
    return false;
}
</script>


</%def>

<%def name="body()">

  <div id="doc3" class="yui-t1">
    <div id="yabi-design-mode">
      <div id="hd">
        <p><img src="/static/images/yabi-logo.png" alt="Yabi-logo" height="60" width="198" />  

            <div id="yabi-message-ajax">
            </div>

            <div id="yabi-tabs">

              <a href="${h.url('jobs')}" id="yabi-tabs-jobs">jobs</a>
              <a href="${h.url('design')}" id="yabi-tabs-design">design</a>
              <a href="${h.url('files')}" id="yabi-tabs-files">files</a>
              <a href="${h.url('help')}" id="yabi-tabs-help">help!</a>
            </div>

            <div id="userinfo">
              ${request.user.username} | <a href="${h.url('logout')}">log out</a>        </div>

      </div>

      <script type="text/javascript">
        //<![CDATA[

        YAHOO.util.Event.onAvailable('yabi-message-success', YAHOO.ccgyabi.YabiMessage.fade, this);
        YAHOO.util.Event.onAvailable('yabi-message-warn', YAHOO.ccgyabi.YabiMessage.fade, this);
        YAHOO.util.Event.onAvailable('yabi-message-fail', YAHOO.ccgyabi.YabiMessage.fade, this);

        //]]>
      </script>
      
      <div id="bd">
        <div id="yui-main">

          <div class="yui-g">
            <div class="yui-g first">
              <div id="yabi-col1" class="yui-u first">
                <div class="yabi-column-contents">
                  <div id="toolContainer"></div>
                </div>
              </div>
              <div id="yabi-col2" class="yui-u">
                <div class="yabi-column-contents">

                  <div id="container"></div>
                </div>
              </div>
            </div>
            <div id="yabi-col3" class="yui-g">
              <div class="yabi-column-contents">
                <div id="optionsDiv"></div>
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>
  </div>
</%def>
